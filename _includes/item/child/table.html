{% comment %}

{% endcomment %}

{% assign data = child.object_location %}
{% assign lang = site.lang %}

<link rel="stylesheet" type="text/css" href="/assets/lib/datatables/datatables.min.css">
<script type="text/javascript" language="javascript" src="{{ '/assets/lib/datatables/datatables.min.js' | relative_url }}"></script>

<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
        var obj_url = '{{ data | default: 'null' }}';
        
        if (obj_url !== 'null') {
            fetch(obj_url)
                .then(response => response.text())
                .then(data => {
                    var build = '<table id="csvTable" class="table table-striped datatable-border" style="width:100%">\n';
                    var rows = data.split("\n");
                    if (rows.length > 0) {
                        build += "<thead><tr>";
                        var headers = rows[0].split(",");
                        for (var i = 0; i < headers.length; i++) {
                            build += "<th scope='col'>" + headers[i] + "</th>";
                        }
                        build += "</tr></thead><tbody>";
                        for (var i = 1; i < rows.length; i++) {
                            if (rows[i].trim().length > 0) { // Ensure there are no empty lines
                                build += "<tr>";
                                var cells = rows[i].split(",");
                                for (var j = 0; j < cells.length; j++) {
                                    build += "<td>" + cells[j] + "</td>";
                                }
                                build += "</tr>";
                            }
                        }
                        build += "</tbody></table>";
                        document.getElementById('wrap').innerHTML = build;
                        
                        // Initialize DataTables
                        $('#csvTable').DataTable({
                            {% if lang != "en" %}language: { url: '{{ "/assets/lib/datatables/" | append: lang | append: ".json" | relative_url }}' },{% endif %}
                            "deferRender": true,
                            dom: '<<"col-12"l>>t<"row"<"col-md-6"><"col-md-6"p><"col-12">><"footer-container"if>',
                            paging: false,
                            ordering: true,
                            scrollX: true,
                            scrollCollapse: true,
                            scrollY: '400px'
                        });
                    } else {
                        console.error('No data found or data format is incorrect.');
                    }
                })
                .catch(error => console.error('Error fetching data:', error));
        }
    });
</script>

<div id="wrap" class="bg-{{ include.background | default: '#ffe880' }} border datatable-border rounded"></div>